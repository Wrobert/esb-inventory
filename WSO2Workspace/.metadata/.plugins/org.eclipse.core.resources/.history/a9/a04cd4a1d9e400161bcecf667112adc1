<?xml version="1.0" encoding="UTF-8"?>
<proxy name="InventoryService" startOnLoad="true" transports="http https" xmlns="http://ws.apache.org/ns/synapse">
    <target>
        <endpoint>
            <address uri="http://localhost:8300/services/InventoryService"/>
        </endpoint>
        <inSequence>
            <log description="logRequest" level="full"/>
            <property expression="//fileLocation" name="fileLocation" scope="default" type="STRING"/>
            <property expression="//source" name="source" scope="default" type="STRING"/>
            <property expression="//destination" name="destination" scope="default" type="STRING"/>
            <property name="FORCE_SC_ACCEPTED" scope="axis2" type="STRING" value="true"/>
            <property name="OUT_ONLY" scope="default" type="STRING" value="true"/>
            <fileconnector.search>
                <source>{$ctx:source}</source>
                <filePattern>.*\.xml</filePattern>
                <recursiveSearch>false</recursiveSearch>
            </fileconnector.search>
            <iterate expression="//ns:result/ns:file" xmlns:ns="http://org.wso2.esbconnectors.FileConnector">
                <target>
                    <sequence>
                        <fileconnector.read>
                            <source>{$ctx:destination}</source>
                        </fileconnector.read>
                    </sequence>
                </target>
            </iterate>
        </inSequence>
        <outSequence/>
        <faultSequence/>
    </target>
</proxy>

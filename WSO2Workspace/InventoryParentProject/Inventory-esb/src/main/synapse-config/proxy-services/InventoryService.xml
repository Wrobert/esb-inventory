<?xml version="1.0" encoding="UTF-8"?>
<proxy name="InventoryService" startOnLoad="true" transports="http https" xmlns="http://ws.apache.org/ns/synapse">
    <target>
        <inSequence>
            <log level="custom" separator=",">
                <property name="InventoryService" value="Inventory Service Started."/>
                <property expression="//operation" name="operation"/>
                <property expression="//contentType" name="contentType"/>
                <property expression="//fileName" name="fileName"/>
                <property expression="//fileLocation" name="fileLocation"/>
                <property expression="//newFileLocation" name="newFileLocation"/>
                <property expression="//fileBeforeProcess" name="fileBeforeProcess"/>
                <property expression="//fileAfterProcess" name="fileAfterProcess"/>
            </log>
            <log description="logRequest" level="full"/>
            <!-- property name="FORCE_SC_ACCEPTED" scope="axis2" type="STRING" value="true"/> 
            <fileconnector.search>
                <source>{$ctx:source}</source>
                <filePattern>.*\.xml</filePattern>
                <recursiveSearch>false</recursiveSearch>
            </fileconnector.search>
            <iterate expression="//ns:result/ns:file" xmlns:ns="http://org.wso2.esbconnectors.FileConnector">
                <target>
                    <sequence>
                    -->
            <!-- call-template description="Call FileConnectorTemplate" target="FileConnectorTemplate">  
                <with-param name="ArgOperation" value="READ"/>
                <with-param name="ArgContentType" value="Application/xml"/>
                <with-param name="ArgFileName" value="Status.xml"/>
                <with-param name="ArgFileLocation" value="file://C:/temp/files/in/"/>
            </call-template>
            -->
            <call-template description="Call FileConnectorTemplate" target="FileConnectorTemplate">
                <with-param name="ArgOperation" value="WRITE"/>
                <with-param name="ArgInputContent" value="Hello Robert"/>
                <with-param name="ArgNewFileLocation" value="file://C:/temp/files/out/my.xml"/>
            </call-template>
            <!-- 
                </target>
            </iterate>
             </sequence>
             -->
            <loopback description="return2caller"/>
        </inSequence>
        <outSequence>
            <log level="custom">
                <property name="InventoryService" value="Inventory Service Left."/>
            </log>
            <send/>
        </outSequence>
        <faultSequence>
            <sequence key="FileErrorSequence"/>
            <send/>
        </faultSequence>
    </target>
</proxy>
